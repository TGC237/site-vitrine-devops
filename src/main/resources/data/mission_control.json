const data = $input.first().json.data.result;

const missionControl = {
  meta: {
    last_update: new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' }),
    environment: "Production - Debian 12"
  },
  infra: {
    ram_available_gb: (data.find(m => m.metric.__name__ === 'node_memory_MemAvailable_bytes')?.value[1] / 1024**3).toFixed(2),
    status: "HEALTHY"
  },
  jenkins: {
    total_jobs: parseInt(data.find(m => m.metric.__name__ === 'jenkins_job_count_value')?.value[1]) || 0,
    build_status: "STABLE"
  },
  security: {
    sonar_status: "PASSED"
  }
};

return [{ json: missionControl }];
